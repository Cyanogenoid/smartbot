#!/usr/bin/env python3
import sys
sys.path.append(".")
import argparse

import yaml

import smartbot
import smartbot.backends
import smartbot.plugins
import smartbot.stores


def read_storage(config):
    name = config["name"]
    del config["name"]

    return getattr(smartbot.stores, name).Storage(**config)


def read_backend(config):
    name = config["name"]
    del config["name"]

    return getattr(smartbot.backends, name).Backend(**config)


def read_plugin(config):
    name = config["name"]
    del config["name"]

    return getattr(smartbot.plugins, name).Plugin(**config)


with open("config.yaml") as fd:
    config = yaml.load(fd.read())

bot = smartbot.Bot(**config["bot"])
bot.set_storage(read_storage(config["storage"]))
bot.set_backend(read_backend(config["backend"]))
bot.set_plugins(map(read_plugin, config["plugins"]))
bot.run()
